<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | CareerLift</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    
    <link rel="stylesheet" href="css/admin.css">

    <script>
        (function() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            if (!token || !userStr) { window.location.href = 'login.html'; return; }
            const user = JSON.parse(userStr);
            if (user.role !== 'admin') {
                window.location.href = 'index.html';
            }
        })();
    </script>
</head>
<body>

    <div class="admin-layout">
        
        <aside class="sidebar" id="adminSidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fa-solid fa-layer-group"></i> 
                    <div>Career<span>Lift</span><small style="color:#94a3b8; font-size:0.65rem; letter-spacing:1px;">ADMIN PANEL</small></div>
                </div>
                <i class="fa-solid fa-xmark close-sidebar" onclick="toggleSidebar()"></i>
            </div>
            
            <ul class="menu">
                <li class="menu-label">Overview</li>
                <li class="active" onclick="showSection('dashboard')">
                    <i class="fa-solid fa-chart-pie"></i> <span>Dashboard</span>
                </li>
                <li onclick="showSection('manage-enrollments')">
                    <i class="fa-solid fa-inbox"></i> <span>Enrollments</span>
                </li>

                <li class="menu-label">Content Management</li>
                <li onclick="showSection('manage-courses')">
                    <i class="fa-solid fa-book-open"></i> <span>All Courses</span>
                </li>
                <li onclick="showSection('add-course')">
                    <i class="fa-solid fa-plus-circle"></i> <span>Add New Course</span>
                </li>

                <li class="menu-label">System</li>
                <li onclick="window.location.href='index.html'">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> <span>Live Website</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <button onclick="logout()" class="logout-btn">
                    <i class="fa-solid fa-power-off"></i> Logout
                </button>
            </div>
        </aside>

        <main class="main-content">
            
            <header class="topbar">
                <div style="display:flex; align-items:center; gap:15px;">
                    <button class="mobile-toggle" onclick="toggleSidebar()">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <h2 style="margin:0; font-size:1.1rem; color:#fff;">Workspace</h2>
                </div>
                
                <div class="admin-profile-pill">
                    <div class="status-dot"></div> 
                    <span>Super Admin</span>
                </div>
            </header>

            <div class="content-wrapper">

                <section id="dashboard" class="admin-section active">
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="glass-card" style="padding: 25px; display: flex; align-items: center; gap: 20px;">
                            <div style="width:50px; height:50px; background:rgba(14, 165, 233, 0.1); color:#0ea5e9; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">
                                <i class="fa-solid fa-users"></i>
                            </div>
                            <div>
                                <h3 id="statUsers" style="margin:0; font-size:1.8rem; color:#fff;">...</h3>
                                <p style="margin:0; font-size:0.85rem; color:#94a3b8;">Registered Users</p>
                            </div>
                        </div>

                        <div class="glass-card" style="padding: 25px; display: flex; align-items: center; gap: 20px;">
                            <div style="width:50px; height:50px; background:rgba(34, 197, 94, 0.1); color:#22c55e; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">
                                <i class="fa-solid fa-graduation-cap"></i>
                            </div>
                            <div>
                                <h3 id="statCourses" style="margin:0; font-size:1.8rem; color:#fff;">...</h3>
                                <p style="margin:0; font-size:0.85rem; color:#94a3b8;">Active Courses</p>
                            </div>
                        </div>

                        <div class="glass-card" style="padding: 25px; display: flex; align-items: center; gap: 20px;">
                            <div style="width:50px; height:50px; background:rgba(245, 158, 11, 0.1); color:#f59e0b; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem;">
                                <i class="fa-solid fa-bell"></i>
                            </div>
                            <div>
                                <h3 id="statPending" style="margin:0; font-size:1.8rem; color:#fff;">...</h3>
                                <p style="margin:0; font-size:0.85rem; color:#94a3b8;">Pending Requests</p>
                            </div>
                        </div>
                    </div>

                    <div class="section-header-row">
                        <h3 style="margin:0; color:#fff;">Recent Users</h3>
                        <button class="btn-small" onclick="fetchUsers()"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
                    </div>
                    <div class="glass-card table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Phone</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="userTableBody">
                                </tbody>
                        </table>
                    </div>
                </section>

                <section id="add-course" class="admin-section">
                    <div class="form-container">
                        <div style="margin-bottom:25px; text-align:center;">
                            <h2 style="color:#fff; margin-bottom:5px;">Create New Course</h2>
                            <p style="color:#94a3b8; font-size:0.9rem;">Fill in the details to publish a new course.</p>
                        </div>

                        <form id="addCourseForm" class="glass-form">
                            
                            <div class="dynamic-fields" style="border:none; background:rgba(255,255,255,0.02); margin-bottom:30px;">
                                <h4 style="color:#38bdf8; margin-bottom:15px; text-transform: uppercase; font-size:0.8rem; letter-spacing:1px;">Basic Information</h4>
                                
                                <div class="form-group">
                                    <label>Course Title</label>
                                    <input type="text" id="cTitle" placeholder="e.g. Full Stack Web Development" required>
                                </div>

                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label>Category</label>
                                        <div class="select-wrapper">
                                            <select id="cCategory">
                                                <option value="Medical & Care">Medical & Care</option>
                                                <option value="IT & Freelancing">IT & Freelancing</option>
                                                <option value="Language">Language</option>
                                                <option value="Diploma">Diploma</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Course Type</label>
                                        <div class="select-wrapper">
                                            <select id="cType" onchange="toggleCourseFields()">
                                                <option value="free">Free Course</option>
                                                <option value="paid">Paid Program</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="dynamic-fields" style="border:none; background:rgba(255,255,255,0.02); margin-bottom:30px;">
                                <h4 style="color:#38bdf8; margin-bottom:15px; text-transform: uppercase; font-size:0.8rem; letter-spacing:1px;">Media & Details</h4>
                                
                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label>Thumbnail URL</label>
                                        <input type="text" id="cThumb" placeholder="Google Drive / Direct Link" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Promo Video URL</label>
                                        <input type="text" id="cVideo" placeholder="YouTube Video Link">
                                    </div>
                                </div>

                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label>Duration</label>
                                        <input type="text" id="cDuration" placeholder="e.g. 3 Months">
                                    </div>
                                    <div class="form-group">
                                        <label>Student Count</label>
                                        <input type="text" id="cStudents" placeholder="e.g. 500+">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label>Short Overview</label>
                                    <textarea id="cOverview" rows="3" placeholder="Brief description for the top section..."></textarea>
                                </div>

                                <div class="form-group">
                                    <label>Target Audience</label>
                                    <textarea id="cAudience" rows="2" placeholder="Who is this course for?"></textarea>
                                </div>

                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label>What they will learn (One per line)</label>
                                        <textarea id="cLearnings" rows="4" placeholder="1. Basic HTML&#10;2. CSS Grid&#10;3. JS Logic"></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label>Key Features (One per line)</label>
                                        <textarea id="cFeatures" rows="4" placeholder="1. Certificate&#10;2. Lifetime Access"></textarea>
                                    </div>
                                </div>
                            </div>

                            <div id="freeFields" class="dynamic-fields" style="background:rgba(34, 197, 94, 0.05); border-color:#22c55e;">
                                <div class="field-group-label" style="color:#22c55e;">Free Course Content</div>
                                <textarea id="cSyllabus" placeholder="Syllabus / Curriculum Text" rows="3" style="margin-bottom:15px;"></textarea>
                                <textarea id="cNote" placeholder="Class Notes / Resource Links" rows="3"></textarea>
                            </div>

                            <div id="paidFields" class="dynamic-fields" style="display:none; background:rgba(14, 165, 233, 0.05); border-color:#0ea5e9;">
                                <div class="field-group-label" style="color:#0ea5e9;">Paid Course Settings</div>
                                
                                <div class="form-row-2">
                                    <div class="form-group">
                                        <label>Current Price</label>
                                        <input type="text" id="cPrice" placeholder="e.g. 10,000 BDT">
                                    </div>
                                    <div class="form-group">
                                        <label>Old Price (Optional)</label>
                                        <input type="text" id="cOldPrice" placeholder="e.g. 15,000 BDT">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label>Secret Code (For Enrollment)</label>
                                    <input type="text" id="cCode" placeholder="e.g. CL-2025">
                                </div>
                                
                                <div class="form-group">
                                    <label>Private Dashboard Note</label>
                                    <textarea id="cPaidNote" placeholder="Instructions shown only to paid students" rows="3"></textarea>
                                </div>

                                <div class="lectures-box" style="margin-top:20px; border-top:1px dashed rgba(255,255,255,0.1); padding-top:15px;">
                                    <label style="color:#fff; margin-bottom:10px; display:block;">Class Playlist (Curriculum)</label>
                                    <div id="lectureContainer">
                                        <div class="lecture-row form-row">
                                            <input type="text" class="lec-title" placeholder="Lecture 1 Topic">
                                            <input type="text" class="lec-link" placeholder="Video/Zoom Link">
                                        </div>
                                    </div>
                                    <button type="button" class="btn-dashed" onclick="addLectureField()">
                                        <i class="fa-solid fa-plus"></i> Add Another Lecture
                                    </button>
                                </div>
                            </div>

                            <button type="submit" class="btn-primary-large" style="margin-top:20px;">
                                <i class="fa-solid fa-cloud-arrow-up"></i> Publish Course
                            </button>
                        </form>
                    </div>
                </section>

                <section id="manage-courses" class="admin-section">
                    <div class="section-header-row">
                        <h2 style="color:#fff;">Course Library</h2>
                    </div>
                    <div id="adminCourseGrid" class="course-grid-admin">
                        </div>
                </section>

                <section id="manage-enrollments" class="admin-section">
                    <div class="section-header-row">
                        <h2 style="color:#fff;">Enrollment Requests</h2>
                    </div>
                    <div class="glass-card table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Info</th>
                                    <th>Course</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th style="text-align: right;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="enrollmentTableBody"></tbody>
                        </table>
                    </div>
                </section>

            </div>
        </main>
    </div>

    <div id="editUserModal" class="modal-overlay">
        <div class="modal-glass">
            <div class="modal-header">
                <h3>Edit User</h3>
                <i class="fa-solid fa-xmark" onclick="closeEditUserModal()"></i>
            </div>
            <form id="editUserForm">
                <input type="hidden" id="editUserId">
                <div class="form-group">
                    <label>Full Name</label>
                    <div class="input-group">
                        <i class="fa-regular fa-user"></i>
                        <input type="text" id="editUserName" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <div class="input-group">
                        <i class="fa-regular fa-envelope"></i>
                        <input type="email" id="editUserEmail" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <div class="input-group">
                        <i class="fa-solid fa-phone"></i>
                        <input type="text" id="editUserPhone">
                    </div>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <div class="select-wrapper">
                        <select id="editUserRole">
                            <option value="student">Student</option>
                            <option value="admin">Admin</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn-modal-action">Update User</button>
            </form>
        </div>
    </div>

    <div id="editCourseModal" class="modal-overlay">
        <div class="modal-glass modal-large" style="max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3>Edit Course Details</h3>
                <i class="fa-solid fa-xmark" onclick="closeEditModal()"></i>
            </div>
            <form id="editCourseForm">
                <input type="hidden" id="editId">
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="editTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="editCategory">
                            <option value="Medical & Care">Medical & Care</option>
                            <option value="IT & Freelancing">IT & Freelancing</option>
                            <option value="Language">Language</option>
                            <option value="Diploma">Diploma</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Price</label>
                        <input type="text" id="editPrice">
                    </div>
                    <div class="form-group">
                        <label>Old Price</label>
                        <input type="text" id="editOldPrice">
                    </div>
                </div>
                
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Thumbnail</label>
                        <input type="text" id="editThumb">
                    </div>
                    <div class="form-group">
                        <label>Video URL</label>
                        <input type="text" id="editVideo">
                    </div>
                </div>

                <div class="form-row-2">
                    <div class="form-group">
                        <label>Duration</label>
                        <input type="text" id="editDuration">
                    </div>
                    <div class="form-group">
                        <label>Students</label>
                        <input type="text" id="editStudents">
                    </div>
                </div>

                <div class="form-group">
                    <label>Overview</label>
                    <textarea id="editOverview" rows="3"></textarea>
                </div>

                <div class="form-group">
                    <label>Target Audience</label>
                    <textarea id="editAudience" rows="2"></textarea>
                </div>
                
                <div class="form-row-2">
                    <div class="form-group">
                        <label>Learnings (Line separated)</label>
                        <textarea id="editLearnings" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Features (Line separated)</label>
                        <textarea id="editFeatures" rows="4"></textarea>
                    </div>
                </div>

                <button type="submit" class="btn-modal-action">Save Changes</button>
            </form>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/admin.js"></script>
    <script>
        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('active');
        }
    </script>
</body>
</html>