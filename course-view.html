<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom | CareerLift</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/nav-footer.css">

    <style>
        /* --- PAGE SPECIFIC STYLES --- */
        body { background-color: var(--color-bg); font-family: 'Inter', sans-serif; }
        
        /* Layout Grid */
        .main-container {
            max-width: 1500px; margin: 100px auto 40px;
            display: grid; grid-template-columns: 1fr 400px; gap: 30px;
            padding: 0 30px;
        }

        /* --- LEFT SIDE: PLAYER & TABS --- */
        .content-wrapper { display: flex; flex-direction: column; gap: 20px; }

        /* 1. VIDEO PLAYER AREA */
        .player-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        .player-content {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* Placeholder Banner (Before clicking video) */
        .course-banner-placeholder {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            display: flex; align-items: center; justify-content: center;
            z-index: 2;
        }
        .banner-overlay {
            background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(5px);
            padding: 40px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.1);
        }

        /* 2. TAB SYSTEM */
        .tabs { display: flex; gap: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 10px; }
        .tab-btn {
            background: transparent; border: none; color: #94a3b8;
            font-size: 1rem; font-weight: 600; padding: 12px 0; cursor: pointer;
            position: relative; transition: 0.3s;
        }
        .tab-btn:hover { color: #fff; }
        .tab-btn.active { color: #38bdf8; }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px;
            background: #38bdf8;
        }

        /* 3. CONTENT CARD */
        .content-card {
            background: rgba(30, 41, 59, 0.6); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px;
            padding: 30px; min-height: 300px;
        }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        .text-content { line-height: 1.8; color: #cbd5e1; font-size: 1rem; white-space: pre-line; }

        /* --- RIGHT SIDE: PLAYLIST --- */
        .playlist-sidebar {
            background: rgba(30, 41, 59, 0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px;
            height: calc(100vh - 140px); position: sticky; top: 100px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .playlist-header {
            padding: 20px 25px; border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(15, 23, 42, 0.6);
        }
        .module-list { flex: 1; overflow-y: auto; padding: 15px; }

        /* Module Item */
        .module-item {
            display: flex; align-items: center; gap: 15px;
            padding: 12px; margin-bottom: 8px;
            background: rgba(255,255,255,0.03); 
            border: 1px solid transparent;
            border-radius: 10px; cursor: pointer; transition: 0.2s;
        }
        .module-item:hover { background: rgba(255,255,255,0.08); }
        
        /* Active Playing State */
        .module-item.playing {
            background: rgba(56, 189, 248, 0.15);
            border-color: #38bdf8;
        }
        .module-item.playing .module-title { color: #38bdf8; font-weight: 700; }
        .module-item.playing .icon-box { background: #38bdf8; color: #000; }

        .icon-box {
            width: 35px; height: 35px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1rem; flex-shrink: 0;
            background: rgba(255,255,255,0.1); color: #cbd5e1;
        }

        .module-info { flex: 1; min-width: 0; }
        .module-title { font-size: 0.9rem; font-weight: 500; color: #f1f5f9; display: block; margin-bottom: 3px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .module-type { font-size: 0.7rem; color: #94a3b8; text-transform: uppercase; font-weight: 600; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }

        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; margin-top: 80px; }
            .playlist-sidebar { height: auto; max-height: 500px; position: static; }
        }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav class="navbar" id="navbar">
        <div class="container nav-container">
            <a href="index.html" class="logo">
                <i class="fa-solid fa-arrow-trend-up"></i> Career<span>Lift</span>
            </a>
            
            <div style="color: #94a3b8; font-size: 0.9rem; font-weight: 500;" class="desktop-only">
                <i class="fa-solid fa-chalkboard-user"></i> My-Classroom
            </div>

            <a href="courses.html" class="btn-outline" style="font-size: 0.85rem;">
                Exit Class <i class="fa-solid fa-right-from-bracket"></i>
            </a>
        </div>
    </nav>

    <div class="main-container">
        
        <div class="content-wrapper">
            
            <div class="player-wrapper">
                
                <iframe id="mainPlayer" class="player-content" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="display: none; z-index: 10;"></iframe>

                <div id="heroBanner" class="course-banner-placeholder">
                    <div class="banner-overlay">
                        <h1 id="cTitle" style="color:#fff; margin-bottom:10px;">Loading Course...</h1>
                        <p style="color:#cbd5e1;">Select a module from the playlist to start learning.</p>
                        <i class="fa-solid fa-play-circle" style="font-size: 4rem; color: #38bdf8; margin-top: 20px; opacity: 0.8;"></i>
                    </div>
                </div>

            </div>

            <div>
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('notes')"><i class="fa-solid fa-book-open"></i> Class Notes</button>
                    <button class="tab-btn" onclick="switchTab('overview')"><i class="fa-solid fa-circle-info"></i> Overview</button>
                </div>

                <div id="tab-notes" class="tab-content active content-card">
                    <div id="cNote" class="text-content">
                        <div style="text-align:center; padding: 40px; color: #64748b;">
                            <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem;"></i>
                            <p style="margin-top:15px;">Fetching resources...</p>
                        </div>
                    </div>
                </div>

                <div id="tab-overview" class="tab-content content-card">
                    <h3 style="margin-bottom:15px; color:#fff; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">About this Course</h3>
                    <p id="cOverview" class="text-content">No overview provided.</p>
                </div>
            </div>

        </div>

        <div class="playlist-sidebar">
            <div class="playlist-header">
                <h3><i class="fa-solid fa-list-check" style="color:#38bdf8;"></i> Course Modules</h3>
            </div>
            
            <div id="lectureList" class="module-list">
                <div style="padding:30px; text-align:center; color:#64748b;">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> Syncing...
                </div>
            </div>
        </div>

    </div>

    <script src="js/main.js"></script>
    <script>
        const API_URL = 'https://careerlift-lms.onrender.com/api/courses'; 

        // Helper: Google Drive Image Fix
        function processDriveLink(url) {
            if (url && url.includes('drive.google.com')) {
                try {
                    const id = url.split('/d/')[1].split('/')[0];
                    return `https://lh3.googleusercontent.com/d/${id}`;
                } catch (err) { return url; }
            }
            return url;
        }

        // --- 1. INITIALIZE ---
        document.addEventListener('DOMContentLoaded', async () => {
            const user = localStorage.getItem('user');
            if(!user) { window.location.href = 'login.html'; return; }

            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('id');
            if(!courseId) { window.location.href = 'courses.html'; return; }

            try {
                const res = await fetch(`${API_URL}`); 
                const courses = await res.json();
                const course = courses.find(c => c._id === courseId);

                if(course) {
                    initClassroom(course);
                } else {
                    alert("Course not found");
                    window.location.href = 'courses.html';
                }
            } catch(err) {
                alert("Connection Error");
            }
        });

        // --- 2. RENDER UI ---
        function initClassroom(course) {
            // Set Hero Info
            document.getElementById('cTitle').innerText = course.title;
            const imgUrl = processDriveLink(course.thumbnail);
            document.getElementById('heroBanner').style.backgroundImage = `linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('${imgUrl}')`;

            // Set Content
            document.getElementById('cOverview').innerText = course.overview || "No overview available.";
            const noteText = course.classNote || course.paidNote || "No specific notes available for this section.";
            document.getElementById('cNote').innerHTML = noteText.replace(/\n/g, '<br>');

            // Render Playlist
            const list = document.getElementById('lectureList');
            list.innerHTML = ''; 

            if(course.type === 'free') {
                renderFreeContent(course, list);
            } else {
                renderPaidContent(course, list);
            }
        }

        // --- 3. CONTENT RENDERERS ---
        function renderFreeContent(course, list) {
            // Free Video (Auto Load if available)
            if(course.videoLink) {
                list.innerHTML += createModuleItem('Free Class Video', course.videoLink, 'Video', 'fa-youtube');
                // Optional: Auto play the first video?
                // playResource(course.videoLink, 'Video', document.querySelector('.module-item')); 
            } else {
                list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b;">No videos uploaded yet.</div>`;
            }
        }

        function renderPaidContent(course, list) {
            if(!course.lectures || course.lectures.length === 0) {
                list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b;">No lectures scheduled.</div>`;
                return;
            }

            course.lectures.forEach((lec, index) => {
                const title = lec.title || `Lecture ${index + 1}`;
                const typeInfo = getLinkType(lec.link);
                list.innerHTML += createModuleItem(title, lec.link, typeInfo.type, typeInfo.icon);
            });
        }

        // --- 4. ITEM CREATOR ---
        function getLinkType(link) {
            if (!link) return { type: 'Resource', icon: 'fa-file' };
            const l = link.toLowerCase();
            if (l.includes('meet.google') || l.includes('zoom.us')) return { type: 'Live Class', icon: 'fa-video' };
            if (l.includes('youtube') || l.includes('youtu.be')) return { type: 'Video', icon: 'fa-play-circle' };
            return { type: 'Resource', icon: 'fa-link' };
        }

        function createModuleItem(title, link, type, icon) {
            // We pass 'this' to handle active state
            return `
                <div class="module-item" onclick="playResource('${link}', '${type}', this)">
                    <div class="icon-box"><i class="fa-solid ${icon}"></i></div>
                    <div class="module-info">
                        <span class="module-title">${title}</span>
                        <span class="module-type">${type}</span>
                    </div>
                    <i class="fa-solid fa-chevron-right" style="font-size:0.8rem; color:#64748b;"></i>
                </div>
            `;
        }

        // --- 5. PLAY LOGIC (THE CORE UPDATE) ---
        function playResource(link, type, element) {
            if(!link) return;

            // Highlight Active Item
            document.querySelectorAll('.module-item').forEach(el => el.classList.remove('playing'));
            if(element) element.classList.add('playing');

            // CASE A: YouTube Video (Embed inside page)
            if (type === 'Video') {
                let embedUrl = "";
                if(link.includes('watch?v=')) embedUrl = `https://www.youtube.com/embed/${link.split('v=')[1]}?autoplay=1`;
                else if(link.includes('youtu.be/')) embedUrl = `https://www.youtube.com/embed/${link.split('.be/')[1]}?autoplay=1`;
                
                if(embedUrl) {
                    // Hide Banner, Show Player
                    document.getElementById('heroBanner').style.display = 'none';
                    const player = document.getElementById('mainPlayer');
                    player.style.display = 'block';
                    player.src = embedUrl;
                }
            } 
            // CASE B: Live Class / External Link (Open New Tab)
            else {
                // Pause player if running
                document.getElementById('mainPlayer').src = "";
                
                window.open(link, '_blank');
            }
        }

        // Tab Logic
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
    </script>
</body>
</html>