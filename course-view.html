<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom | CareerLift</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-body: #0f172a;
            --bg-panel: #1e293b;
            --primary: #38bdf8;
            --accent: #8b5cf6;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --border: 1px solid rgba(255, 255, 255, 0.08);
            
            /* Brand Colors */
            --brand-youtube: #ef4444;
            --brand-meet: #22c55e;
            --brand-zoom: #3b82f6;
            --brand-default: #a855f7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: var(--bg-body); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        h1, h2, h3, .btn-font { font-family: 'Outfit', sans-serif; }

        /* --- Navbar --- */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: var(--border);
            height: 70px;
            position: fixed; top: 0; width: 100%; z-index: 1000;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%;
        }
        .logo { font-size: 1.5rem; font-weight: 700; color: #fff; text-decoration: none; display: flex; align-items: center; gap: 8px; }
        .logo i { color: var(--primary); }
        .back-btn { 
            color: var(--text-muted); text-decoration: none; font-size: 0.9rem; font-weight: 500; 
            transition: 0.3s; display: flex; align-items: center; gap: 8px;
            padding: 8px 16px; border-radius: 50px; border: 1px solid transparent;
        }
        .back-btn:hover { border-color: rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #fff; }

        /* --- Layout Grid --- */
        .main-container {
            max-width: 1500px; margin: 90px auto 40px;
            display: grid; grid-template-columns: 1fr 400px; gap: 30px;
            padding: 0 30px;
        }

        /* --- Left Side: Hero & Tabs --- */
        .content-wrapper { display: flex; flex-direction: column; gap: 25px; }

        /* HERO BANNER (Clean & Focused) */
        .hero-banner {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            background: var(--bg-panel);
            border: var(--border);
            min-height: 250px;
            display: flex; align-items: flex-end;
        }
        .hero-bg {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            filter: blur(4px) brightness(0.3);
            z-index: 0;
        }
        .hero-content {
            position: relative; z-index: 1;
            padding: 40px; width: 100%;
            background: linear-gradient(to top, var(--bg-body) 0%, transparent 100%);
        }
        .course-badge {
            display: inline-block; padding: 5px 12px; background: var(--primary); color: #000;
            border-radius: 6px; font-weight: 600; font-size: 0.75rem; text-transform: uppercase;
            margin-bottom: 15px; letter-spacing: 0.5px;
        }
        .hero-title { font-size: 2.2rem; line-height: 1.2; margin-bottom: 5px; color: #fff; }

        /* TAB SYSTEM */
        .tabs { display: flex; gap: 30px; border-bottom: var(--border); margin-bottom: 10px; }
        .tab-btn {
            background: transparent; border: none; color: var(--text-muted);
            font-size: 1rem; font-weight: 500; padding: 12px 0; cursor: pointer;
            position: relative; transition: 0.3s;
        }
        .tab-btn:hover { color: #fff; }
        .tab-btn.active { color: var(--primary); }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px;
            background: var(--primary);
        }

        /* CONTENT CARD (Reading Area) */
        .content-card {
            background: var(--bg-panel); border: var(--border); border-radius: 16px;
            padding: 40px; min-height: 400px;
        }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }
        
        /* Note Styling */
        .text-content { 
            line-height: 1.8; color: #e2e8f0; font-size: 1.05rem; white-space: pre-line; 
        }

        /* --- Right Side: Smart Playlist --- */
        .playlist-sidebar {
            background: var(--bg-panel); border: var(--border); border-radius: 16px;
            height: calc(100vh - 120px); position: sticky; top: 90px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .playlist-header {
            padding: 20px 25px; border-bottom: var(--border);
            background: rgba(15, 23, 42, 0.3);
        }
        .playlist-header h3 { font-size: 1.1rem; color: #fff; display: flex; align-items: center; gap: 10px; }
        
        .module-list { flex: 1; overflow-y: auto; padding: 15px; }

        /* SMART MODULE ITEM */
        .module-item {
            display: flex; align-items: center; gap: 15px;
            padding: 16px; margin-bottom: 10px;
            background: rgba(15, 23, 42, 0.6); 
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; cursor: pointer; transition: 0.2s;
            position: relative; overflow: hidden;
        }
        .module-item:hover { 
            background: rgba(30, 41, 59, 0.8); 
            border-color: rgba(255,255,255,0.1); 
            transform: translateX(5px);
        }
        
        .icon-box {
            width: 42px; height: 42px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; flex-shrink: 0;
            background: rgba(255,255,255,0.05);
        }

        .module-info { flex: 1; min-width: 0; }
        .module-title { font-size: 0.95rem; font-weight: 500; color: #f1f5f9; display: block; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .module-type { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        
        /* Brand Specific Styles */
        .brand-youtube .icon-box { color: var(--brand-youtube); background: rgba(239, 68, 68, 0.1); }
        .brand-meet .icon-box { color: var(--brand-meet); background: rgba(34, 197, 94, 0.1); }
        .brand-zoom .icon-box { color: var(--brand-zoom); background: rgba(59, 130, 246, 0.1); }
        .brand-default .icon-box { color: var(--brand-default); background: rgba(168, 85, 247, 0.1); }

        .brand-youtube:hover { border-color: rgba(239, 68, 68, 0.3); }
        .brand-meet:hover { border-color: rgba(34, 197, 94, 0.3); }
        .brand-zoom:hover { border-color: rgba(59, 130, 246, 0.3); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }

        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .playlist-sidebar { height: auto; max-height: 500px; position: static; }
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <a href="index.html" class="logo">
            <i class="fa-solid fa-arrow-trend-up"></i> Career<span>Lift</span>
        </a>
        <a href="courses.html" class="back-btn">
            <i class="fa-solid fa-arrow-left"></i> Back to Courses
        </a>
    </nav>

    <div class="main-container">
        
        <div class="content-wrapper">
            
            <div class="hero-banner">
                <div id="heroBg" class="hero-bg"></div>
                <div class="hero-content">
                    <span id="cBadge" class="course-badge">Loading...</span>
                    <h1 id="cTitle" class="hero-title">Loading Course...</h1>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('notes')"><i class="fa-solid fa-book-open"></i> Study Notes</button>
                <button class="tab-btn" onclick="switchTab('overview')"><i class="fa-solid fa-circle-info"></i> Overview</button>
            </div>

            <div id="tab-notes" class="tab-content active content-card">
                <div id="cNote" class="text-content">
                    <div style="text-align:center; padding: 60px; color: var(--text-muted);">
                        <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem;"></i>
                        <p style="margin-top:15px;">Loading materials...</p>
                    </div>
                </div>
            </div>

            <div id="tab-overview" class="tab-content content-card">
                <h3 style="margin-bottom:15px; color:#fff; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:10px;">About this Course</h3>
                <p id="cOverview" class="text-content">No overview provided.</p>
            </div>

        </div>

        <div class="playlist-sidebar">
            <div class="playlist-header">
                <h3><i class="fa-solid fa-list-check" style="color:var(--primary);"></i> Class Modules</h3>
            </div>
            
            <div id="lectureList" class="module-list">
                <div style="padding:30px; text-align:center; color:var(--text-muted);">
                    <i class="fa-solid fa-circle-notch fa-spin"></i> Syncing...
                </div>
            </div>
        </div>

    </div>

    <script>
        const API_URL = 'https://careerlift-lms.onrender.com/api/courses'; 

        // Helper: Drive Image Fix
        function processDriveLink(url) {
            if (url && url.includes('drive.google.com')) {
                try {
                    const idPart = url.split('/d/')[1];
                    const imageId = idPart.split('/')[0];
                    return `https://lh3.googleusercontent.com/d/${imageId}`;
                } catch (err) { return url; }
            }
            return url;
        }

        // ðŸ”¥ SMART ICON DETECTOR
        function getLinkMetadata(link) {
            if (!link) return { icon: 'fa-lock', type: 'Locked', brand: 'brand-default' };
            
            const lowerLink = link.toLowerCase();
            
            if (lowerLink.includes('meet.google.com')) {
                return { icon: 'fa-video', type: 'Google Meet', brand: 'brand-meet' };
            }
            if (lowerLink.includes('zoom.us')) {
                return { icon: 'fa-video', type: 'Zoom Meeting', brand: 'brand-zoom' };
            }
            if (lowerLink.includes('youtube.com') || lowerLink.includes('youtu.be')) {
                return { icon: 'fa-youtube', type: 'YouTube Video', brand: 'brand-youtube' };
            }
            if (lowerLink.includes('drive.google.com')) {
                return { icon: 'fa-google-drive', type: 'Drive Resource', brand: 'brand-meet' }; // reusing green
            }
            
            return { icon: 'fa-play-circle', type: 'Class Link', brand: 'brand-default' };
        }

        // Tab Logic
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const user = localStorage.getItem('user');
            if(!user) { window.location.href = 'login.html'; return; }

            const urlParams = new URLSearchParams(window.location.search);
            const courseId = urlParams.get('id');
            if(!courseId) { window.location.href = 'courses.html'; return; }

            try {
                const res = await fetch(`${API_URL}`); 
                const courses = await res.json();
                const course = courses.find(c => c._id === courseId);

                if(course) renderCourseDetails(course);
                else window.location.href = 'courses.html';
            } catch(err) {
                console.error(err);
                alert("Connection Error");
            }
        });

        function renderCourseDetails(course) {
            // Hero
            document.getElementById('cTitle').innerText = course.title;
            document.getElementById('cBadge').innerText = course.category || "General";
            
            const imgUrl = processDriveLink(course.thumbnail);
            document.getElementById('heroBg').style.backgroundImage = `url('${imgUrl}')`;

            // Content
            document.getElementById('cOverview').innerText = course.overview || "No overview available.";
            const noteText = course.classNote || course.paidNote || "No notes available currently.";
            document.getElementById('cNote').innerHTML = noteText.replace(/\n/g, '<br>');

            // Sidebar List
            const list = document.getElementById('lectureList');
            list.innerHTML = ''; 

            if(course.type === 'free') {
                renderFreeContent(course, list);
            } else {
                renderPaidContent(course, list);
            }
        }

        function renderFreeContent(course, list) {
            let html = '';
            
            // Syllabus
            if(course.syllabus) {
                html += createSmartItem('Syllabus & Outline', '#', 'Syllabus', 'fa-list-ul', 'brand-default', false);
            }

            // Video Link (Smart Detection)
            if(course.videoLink) {
                const meta = getLinkMetadata(course.videoLink);
                html += createSmartItem('Free Class Resource', course.videoLink, meta.type, meta.icon, meta.brand, true);
            } else {
                html += `<div style="text-align:center; padding:20px; color:#64748b; font-size:0.9rem;">No resources added yet.</div>`;
            }

            list.innerHTML = html;
        }

        function renderPaidContent(course, list) {
            if(!course.lectures || course.lectures.length === 0) {
                list.innerHTML = `<div style="text-align:center; padding:20px; color:#64748b; font-size:0.9rem;">No lectures scheduled.</div>`;
                return;
            }

            course.lectures.forEach((lec, index) => {
                const meta = getLinkMetadata(lec.link);
                const title = lec.title || `Lecture ${index + 1}`;
                
                list.innerHTML += createSmartItem(title, lec.link, meta.type, meta.icon, meta.brand, true);
            });
        }

        function createSmartItem(title, link, typeText, iconClass, brandClass, isClickable) {
            const clickAttr = isClickable ? `onclick="openLink('${link}')"` : '';
            const arrow = isClickable ? '<i class="fa-solid fa-chevron-right" style="color:var(--text-muted); font-size:0.8rem;"></i>' : '';

            return `
                <div class="module-item ${brandClass}" ${clickAttr}>
                    <div class="icon-box">
                        <i class="fa-solid ${iconClass}"></i>
                    </div>
                    <div class="module-info">
                        <span class="module-title">${title}</span>
                        <span class="module-type">${typeText}</span>
                    </div>
                    ${arrow}
                </div>
            `;
        }

        function openLink(link) {
            if(link && link !== '#') {
                window.open(link, '_blank');
            }
        }
    </script>
</body>
</html>